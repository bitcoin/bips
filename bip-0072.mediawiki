<pre>
  BIP: 72
  Layer: Applications
  Title: bitcoin: uri extensions for Payment Protocol
  Author: Gavin Andresen <gavinandresen@gmail.com>
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0072
  Status: Final
  Type: Standards Track
  Created: 2013-07-29
</pre>

==Abstract==

This BIP describes an extension to the bitcoin: URI scheme (BIP 21) to
support the payment protocol (BIP 70).

==Motivation==

Allow users to click on a link in a web page or email to initiate the
payment protocol, while being backwards-compatible with existing
bitcoin wallets.

==Specification==

The bitcoin: URI scheme is extended with an additional, optional
"r" parameter, whose value is a URL from which a PaymentRequest
message should be fetched (characters not allowed within the scope
of a query parameter must be percent-encoded as described in RFC 3986
and bip-0021).

If the "r" parameter is provided, then an additional "h" parameter
may be provided. If provided, it must contain an unpadded
Base64Url-encoded SHA256 hash of the PaymentRequest message bytes
referred to by the "r" parameter.

If the "r" parameter is provided and backwards compatibility
is not required, then the bitcoin address portion of the URI may be
omitted (the URI will be of the form: bitcoin:?r=... ).

When Bitcoin wallet software receives a bitcoin: URI with a "r" and "h"
parameters and the hash in the "h" parameter matches the hash of the
PaymentRequest message fetched via the "r" parameter, it must ignore
the BIP 21 parameters (address, amount, label and message) in the URI
and instead follow the payment protocol as described in BIP 70. The
software may use any present BIP 21 parameter as a fallback if fetching
the PaymentRequest fails, the "h" parameter is missing or the hash
doesn't match.

A non-matching hash must be handled identically to a missing "h"
parameter, in order to be able to match to different objects in
future versions of this spec.

Bitcoin wallets must support fetching PaymentRequests via http and
https protocols; they may support other protocols. Wallets must
include an "Accept" HTTP header in HTTP(s) requests (as defined
in RFC 2616):

<pre>Accept: application/bitcoin-paymentrequest</pre>

If a PaymentRequest cannot be obtained (perhaps the server is
unavailable), then the customer should be informed that the merchant's
payment processing system is unavailable. In the case of an HTTP
request, status codes which are neither success nor error (such as
redirect) should be handled as outlined in RFC 2616.

==Compatibility==

Wallet software that does not support this BIP will simply ignore the
r and h parameters and will initiate a payment to bitcoin address.

==Examples==
A backwards-compatible request:
<pre>
bitcoin:mq7se9wy2egettFxPbmn99cK8v5AFq55Lx?amount=0.11&r=https://merchant.com/pay.php?h%3D2a8628fc2fbe
</pre>
Non-backwards-compatible equivalent:
<pre>
bitcoin:?r=https://merchant.com/pay.php?h%3D2a8628fc2fbe
</pre>

==References==

[[http://www.w3.org/Protocols/rfc2616/rfc2616.html|RFC 2616]] : Hypertext Transfer Protocol -- HTTP/1.1 
